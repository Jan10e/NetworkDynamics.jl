<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Experimental DDE Tutorial · NetworkDynamics</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">NetworkDynamics</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">General</a></li><li><a class="tocitem" href="../BasicConstructors/">Functions</a></li><li><a class="tocitem" href="../parameters/">Parameter handling</a></li><li><a class="tocitem" href="../Multithreading/">Multi-Threading</a></li><li><a class="tocitem" href="../Library/">Library</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../getting_started_with_network_dynamics/">Getting started</a></li><li><a class="tocitem" href="../directed_and_weighted_graphs/">Directed and weighted graphs</a></li><li><a class="tocitem" href="../heterogeneous_system/">Heterogeneous systems</a></li><li><a class="tocitem" href="../SDEVertex/">Stochastic differential equations</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Experimental DDE Tutorial</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Experimental DDE Tutorial</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/FHell/NetworkDynamics.jl/blob/master/docs/src/DDEVertex.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Experimental-DDE-Tutorial-1"><a class="docs-heading-anchor" href="#Experimental-DDE-Tutorial-1">Experimental DDE Tutorial</a><a class="docs-heading-anchor-permalink" href="#Experimental-DDE-Tutorial-1" title="Permalink"></a></h1><p>An <code>IJulia</code> <a href="https://github.com/FHell/NetworkDynamics.jl/tree/master/examples">notebook</a> corresponding to this tutorial will be available on GitHub soon.</p><h4 id="Topics-covered-in-this-tutorial-include:-1"><a class="docs-heading-anchor" href="#Topics-covered-in-this-tutorial-include:-1">Topics covered in this tutorial include:</a><a class="docs-heading-anchor-permalink" href="#Topics-covered-in-this-tutorial-include:-1" title="Permalink"></a></h4><ul><li>constructing a watts_strogatz graph</li><li>diffusion delay differential equation (DDE)</li><li>parameter handling with DDE&#39;s</li><li>stiff equations</li><li>Kuramoto Delay Model</li></ul><h2 id="Network-Diffusion-1"><a class="docs-heading-anchor" href="#Network-Diffusion-1">Network Diffusion</a><a class="docs-heading-anchor-permalink" href="#Network-Diffusion-1" title="Permalink"></a></h2><p>This example explains the use of delay differential equations (DDE&#39;s) in NetworkDynamics.jl by modeling a simple diffusion on an undirected ring network with delay.</p><p>Let <span>$g$</span> be a graph with <span>$N$</span> nodes and adjacency matrix <span>$A$</span>. Let <span>$v = (v_1, \dots, v_n)$</span> be a vector of (abstract) temperatures or concentrations at each node <span>$i = 1, \dots, N$</span>. The rate of change of state <span>$v_i$</span> in this artificial example is described by the delay value of <span>$v_i$</span> with delay <span>$\Tau$</span> and its difference with its neighbors with coupling strength <span>$\sigma$</span>. We obtain the following ordinary differential equation</p><div>\[\begin{aligned}
\dot v_i = - v_i(\Tau) - \sigma * \sum_{i=1}^N A_{ij} (v_i - v_j)
\end{aligned}\]</div><p>The sum on the right hand side plays the role of a (discrete) gradient. If the temperature at node <span>$i$</span> is higher than at its neighboring node <span>$j$</span> it will decrease along that edge.</p><h2 id="Modeling-diffusion-with-delay-in-NetworkDynamics.jl-1"><a class="docs-heading-anchor" href="#Modeling-diffusion-with-delay-in-NetworkDynamics.jl-1">Modeling diffusion with delay in NetworkDynamics.jl</a><a class="docs-heading-anchor-permalink" href="#Modeling-diffusion-with-delay-in-NetworkDynamics.jl-1" title="Permalink"></a></h2><p>From the equation above we see that in this model the dynamics of the nodes consist of internal dynamics as well as a coupling term with the neighboring nodes. In NetworkDynamics.jl the interactions with the neighbors are described by equations for the edges.</p><pre><code class="language-julia">function diffusionedge!(e, v_s, v_d, p, t)
   # usually e, v_s, v_d are arrays, hence we use the broadcasting operator .
   e .= .1 * (v_s .- v_d)
   nothing
end</code></pre><p>The internal dynamics are determined by the delay value <span>$\dot v_i = v_i(\Tau)$</span> and are described in the vertex function with help of the history array <span>$h_v$</span> containing the delay values of the vertex.</p><pre><code class="language-julia">function diffusionvertex!(dv, v, e_s, e_d, h_v, p, t)
   # usually dv, v, e_s, e_d, h_v are arrays, hence we use the broadcasting operator .
   # h_v is the history array of the vertices
   dv .= -h_v
   # edges for which v is the source
   for e in e_s
       dv .-= e
   end
   # edges for which v is the destination
   for e in e_d
       dv .+= e
   end
   nothing
end</code></pre><h1 id="Constructing-the-Network-Dynamics-1"><a class="docs-heading-anchor" href="#Constructing-the-Network-Dynamics-1">Constructing the Network Dynamics</a><a class="docs-heading-anchor-permalink" href="#Constructing-the-Network-Dynamics-1" title="Permalink"></a></h1><p>Constructing the network dynamics is straightforward</p><pre><code class="language-julia">using LightGraphs

### Defining a graph

N = 20 # number of nodes
k = 8  # average degree
g = watts_strogatz(N, k, 0.) # ring-network</code></pre><pre><code class="language-none">{20, 80} undirected simple Int64 graph</code></pre><p>The Watts-Strogatz algorithm constructs a regular-ring network with <span>$N$</span> nodes, <span>$k$</span> neighbors and a probability <span>$p$</span> of rewiring links, which is chosen as <span>$p=0$</span> here.</p><pre><code class="language-julia">using NetworkDynamics

nd_diffusion_vertex = DDEVertex(f! = diffusionvertex!, dim = 1)
nd_diffusion_edge = StaticEdge(f! = diffusionedge!, dim = 1)

nd = network_dynamics(nd_diffusion_vertex, nd_diffusion_edge, g)</code></pre><pre><code class="language-none">(::DiffEqBase.DDEFunction{true,nd_DDE_Static{LightGraphs.SimpleGraphs.SimpleGraph{Int64},Array{Float64,1},Array{Float64,1},DDEVertex{typeof(Main.ex-DDEVertex.diffusionvertex!)},StaticDelayEdge{NetworkDynamics.ComponentFunctions.var&quot;#65#66&quot;{StaticEdge{typeof(Main.ex-DDEVertex.diffusionedge!)}}}},LinearAlgebra.UniformScaling{Bool},Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Array{Symbol,1},Nothing}) (generic function with 2 methods)</code></pre><p>Now we hand over the functions we have defined above to the constructors <code>DDEVertex</code> and <code>StaticEdge</code>, adding information on the dimension of variables at each edge or node with keyword <strong><code>dim</code></strong>. The wrapper function <code>DDEVertex</code> is a new feature describing internal delay dynamics of nodes. The resulting objects can then be delivered to the key constructor <code>network_dynamics</code>, which adds topological information of graph <strong><code>g</code></strong> and returns an <code>DDEFunction</code>, which is compatible with the solvers of <code>DifferentialEquations.jl</code>.</p><h1 id="Simulation-1"><a class="docs-heading-anchor" href="#Simulation-1">Simulation</a><a class="docs-heading-anchor-permalink" href="#Simulation-1" title="Permalink"></a></h1><p>First we set the initial conditions, the time-interval <code>tspan</code>, construct the history function <code>h(x,p,t)</code> and set the parameters <code>p</code>, which are now extended to take parameters for the delay-time too.</p><pre><code class="language-julia">x0 = randn(N) # random initial conditions
tspan = (0., 10.) #time interval

# history function defaults to all 1. and is in-place to save allocations
h(out, p, t) = (out .= 1.)

#parameters p = (vertex parameters, edge parameters, delay time)
p = (nothing, nothing, 1.)</code></pre><pre><code class="language-none">(nothing, nothing, 1.0)</code></pre><p>Then we solve the diffusion problem. The constructor <code>DDEProblem</code> is from the package <code>DealyDiffEq.jl</code> and wraps up the <code>DDEFunction</code> with the initial conditions <code>x0</code> , the history function <code>h</code> , time-interval <code>tspan</code> and parameters <code>p</code>, which can than be handed over to the <code>solve</code> method.</p><pre><code class="language-julia">using OrdinaryDiffEq
using DelayDiffEq

dde_prob = DDEProblem(nd, x0, h, tspan, p)
sol = solve(dde_prob, MethodOfSteps(Tsit5()))</code></pre><pre><code class="language-none">retcode: Success
Interpolation: specialized 4th order &quot;free&quot; interpolation
t: 22-element Array{Float64,1}:
  0.0                 
  0.005019738712658646
  0.055217125839245096
  0.23723457865029615 
  0.5428403646073545  
  0.9062249147013213  
  1.2065520621779895  
  1.3699671422386137  
  1.867092944208356   
  2.2441220317095842  
  ⋮                   
  4.172541328123057   
  4.822568805175534   
  5.441489765192646   
  6.148897856905586   
  6.937983511489904   
  7.713244838765156   
  8.619557157202879   
  9.431837719088522   
 10.0                 
u: 22-element Array{Array{Float64,1},1}:
 [-0.33588985970756075, 0.5843744536825907, 0.002465766029372154, -1.8946870799756927, -0.7434965675459129, 1.243801588142725, 0.5620857382170719, 0.9423909114328332, 0.7354622463659124, -0.6942998786648296, 0.7601305200214538, -0.346584921112461, -1.2753008324377793, -0.22993019952080318, -0.008197325936688515, -0.9757849766247001, 0.9457515488993871, 1.6498174818591624, 1.3345627954506902, 8.188401230819009e-5]                                        
 [-0.33862272512188263, 0.5776423206223944, -0.0021871790208489693, -1.8909847691483395, -0.7446158726759831, 1.233545305030164, 0.5549899925660613, 0.9334062555162933, 0.727719669251019, -0.6953412202218581, 0.7519077263609311, -0.3505875803392765, -1.275115487716705, -0.23399980434765716, -0.012252374646380576, -0.975858247457586, 0.9370224830260747, 1.6388444541071725, 1.3251270491912466, -0.004281476640933379]                                       
 [-0.36650726505606473, 0.510702462609327, -0.04873972410221832, -1.8560160072363816, -0.7567745278970306, 1.1322966820655065, 0.4845338914973628, 0.8445406833092849, 0.6508772082332925, -0.7068891145155184, 0.6704674851171218, -0.39067084534255053, -1.274336213454291, -0.2748158429626213, -0.05315099490636247, -0.9778097178921695, 0.850663857156661, 1.5304096082702965, 1.231673323369573, -0.04804417246104026]                                           
 [-0.47554273167153827, 0.2734173843419723, -0.21793821282739484, -1.7584819513726107, -0.8145708513627489, 0.7838024038264221, 0.2361840991147605, 0.5362512303141918, 0.38063764780495235, -0.7646947619384364, 0.3863723921398752, -0.5369949757828608, -1.28696064281477, -0.4246245397143699, -0.2062793934002614, -1.0021910824855615, 0.5507389379967315, 1.1557616594983526, 0.9057902776827023, -0.20861516976825073]                                          
 [-0.6826148904151629, -0.1084772264568968, -0.5036891021761737, -1.6832274586228702, -0.9527556221618209, 0.25448339254260793, -0.1593349964993172, 0.06056227547232253, -0.04714932661931257, -0.9084098174481156, -0.056799680559145936, -0.7868069255944111, -1.3558779393012237, -0.6822886558426164, -0.4771096959289642, -1.0950898844378958, 0.08670633785318366, 0.5833979897916309, 0.3986535258747694, -0.48422629903059666]                                 
 [-0.9595621700052946, -0.5413618496058819, -0.8465582219412856, -1.7069244751951695, -1.1690371865665339, -0.3046890858542287, -0.6023574641564782, -0.4519385473732555, -0.5215579407137187, -1.1359103575270733, -0.5407112145096996, -1.0915024137711697, -1.500841998869729, -0.9978670025640224, -0.814947573031668, -1.2712489701655176, -0.4153790587491681, -0.023488401819684153, -0.15162421845199403, -0.8202368505677686]                                  
 [-0.8523032217632588, -0.7371406540876401, -0.8490120857473518, -1.0884430954389512, -0.9312170331612091, -0.7169867913428529, -0.7934006284220496, -0.7677054231356805, -0.7731098791968725, -0.9220093801990845, -0.7976646874880243, -0.9795888192637782, -1.0840370285911496, -0.9255171224313458, -0.8217116092058155, -0.9569489923846225, -0.7284782736225615, -0.572369195911288, -0.5973088263091771, -0.8221013167927961]                                    
 [-0.7664061400160199, -0.7759124995217834, -0.8026283893284994, -0.7876721966207018, -0.7893371202119229, -0.8366894434377259, -0.8243767181550582, -0.8469926293196652, -0.8299720970125839, -0.7931061245746197, -0.8522588845710197, -0.8753069932075133, -0.856146801742945, -0.8429512637875339, -0.7835627628694525, -0.7840173424740664, -0.8102439576455409, -0.7612685959742185, -0.7458297240331948, -0.7790425805143706]                                    
 [-0.43396268794062937, -0.6561465137565046, -0.5195101311022394, -0.07109907420368727, -0.3505895689944232, -0.8276205234080277, -0.6692932297033501, -0.7643232618343073, -0.7195483984779739, -0.38107194373659503, -0.7247354605357493, -0.4557925493574838, -0.23124785315457855, -0.4782372399023434, -0.5305099625192209, -0.29363853263321776, -0.7470127708059415, -0.9126923662927411, -0.8350339248718934, -0.5138016866157208]                              
 [-0.13275486638899445, -0.3764882554423422, -0.20421974708716434, 0.28984134384332866, -0.02429189006258176, -0.528922782140334, -0.3597493878142014, -0.45130419521704174, -0.4130464616313667, -0.05780071558049121, -0.40339921199994705, -0.08422177111338496, 0.15556711594548897, -0.13135050735139805, -0.23125328393547143, 0.03636229498560348, -0.4553615333948479, -0.6758707632060083, -0.5989580522307257, -0.21378283956777347]                          
 ⋮                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
 [0.23879236791413386, 0.3193801637383016, 0.2572828059824435, 0.09831991548311722, 0.20617532784687084, 0.366672974290263, 0.3159348068361094, 0.3437480053382895, 0.33701694055964476, 0.2279559990409829, 0.3288430646530582, 0.21490042064511014, 0.13722594959208279, 0.23388266851288037, 0.27895665330189906, 0.18586585516999013, 0.3410759655371016, 0.42425655675196877, 0.40053200840718783, 0.2627301259130474]                                             
 [0.0380128435718983, 0.05279674282344569, 0.027580788438878474, -0.006289433814658587, 0.01744144226982277, 0.03799260996846674, 0.02913557273784834, 0.02597406058774499, 0.02875527120222216, 0.015100257734674633, 0.019161306419053087, -0.01439826709939488, -0.025050348164535174, 0.0033024546667041166, 0.03524652733419973, 0.014900278576929457, 0.04406808520662902, 0.08247644562364152, 0.08321034873139632, 0.039162817313140606]                        
 [-0.11966592474641374, -0.14903123772304294, -0.1359399982128399, -0.08388711684301713, -0.12164851463314286, -0.1851175223506053, -0.16852477708608918, -0.18461116337926167, -0.18123510690218061, -0.1396471731355189, -0.1830447905768137, -0.1487098056300387, -0.1179975729142493, -0.14490363303237466, -0.14625024103599152, -0.1130805868666655, -0.16590220096268726, -0.1809700301636156, -0.16871988559372308, -0.12991180126437546]                       
 [-0.16594771517424475, -0.19012229203854103, -0.16884227710680597, -0.12302237252220673, -0.1576022561132469, -0.20313813643655115, -0.19048565678416213, -0.19747569247788208, -0.1980949341607251, -0.16919728255960115, -0.19334270933202635, -0.15517473129345263, -0.13254431013942175, -0.16239277173268196, -0.18150948925277083, -0.15126948156872075, -0.19450690305630652, -0.22471341830509667, -0.21842439638136146, -0.17171088080109437]                 
 [-0.06743724509284628, -0.0625555037669475, -0.05987635632759424, -0.06605004556403715, -0.060978904011665905, -0.04792670548392174, -0.050288853731155984, -0.044602148933124156, -0.04592566055393617, -0.05421251218619366, -0.04310880789498944, -0.044919399089808736, -0.051179971255560834, -0.05062669159137294, -0.05809304483955706, -0.06284969954380235, -0.055313366313505474, -0.06075517998713225, -0.06456608509238634, -0.06477468856995686]          
 [0.052931425852308464, 0.06443781548058136, 0.0564872912108231, 0.03704963219445395, 0.053703353922190826, 0.07618405382455434, 0.07151400851505457, 0.07628807748718314, 0.07706434084956665, 0.063851796952276, 0.07562038935985543, 0.05851585625871934, 0.047187627065102114, 0.05905381450893336, 0.0650979289693225, 0.05024572606151029, 0.06869108015879478, 0.07988681644301251, 0.07601611582627195, 0.05573019728718242]                                    
 [0.08199050622160668, 0.08160736170674675, 0.07907489659484046, 0.07877640196042925, 0.07926233394568732, 0.07703206705720973, 0.07746179026362221, 0.07559181175420934, 0.07630206300560742, 0.07796193613278792, 0.07480372722765306, 0.07288352682597175, 0.07388209534927179, 0.07548253427397003, 0.0797905985480674, 0.07951927567926446, 0.07900371617684623, 0.08337439047545112, 0.08447853024099662, 0.08118035751978003]                                    
 [0.01944583480442726, 0.014956337911450802, 0.017491018757563866, 0.02414733842081399, 0.017437452561589108, 0.008556755453603702, 0.009754772030625065, 0.007487447044104325, 0.006851451202371831, 0.011576706787365235, 0.007284336262049885, 0.013855326546589653, 0.018420570122777702, 0.014532329983522543, 0.01285123728144022, 0.018955702919869002, 0.012697165833988888, 0.00907005094680588, 0.010823669754614535, 0.018424174191026873]                   
 [-0.024870353917094988, -0.02703169284682694, -0.024769195486275698, -0.021496739723213924, -0.02532539353539221, -0.029034294879648922, -0.028861280901288693, -0.029328423856064587, -0.030081303712146044, -0.02851147407867905, -0.029242440010457057, -0.025009674155751834, -0.023014241429727605, -0.025470332288889088, -0.027997681193509552, -0.024576541921089885, -0.02726082480126286, -0.03087362674325808, -0.030363402658077996, -0.024996274119257485]</code></pre><p>We solve the problem with delay on the time interval <span>$[0, 10]$</span> with the <code>Tsit5()</code> algorithm, which is the Tsitouras 5/4 Runge-Kutta method (a free 4th order interpolant), recommended for solving non-stiff problems. The additional algorithm <code>MethodOfSteps</code> translates an <code>OrdinaryDiffEq.jl</code> ODE solver method into a method for delay differential equations which is highly efficient.</p><h2 id="Bonus:-Two-independet-diffusions-1"><a class="docs-heading-anchor" href="#Bonus:-Two-independet-diffusions-1">Bonus: Two independet diffusions</a><a class="docs-heading-anchor-permalink" href="#Bonus:-Two-independet-diffusions-1" title="Permalink"></a></h2><p>In this extension of the first example, we will have two independent diffusions on the same network with variables <span>$x$</span> and <span>$\phi$</span>, such that the <strong><code>dim</code></strong>=2. First we construct the <code>network_dynamics</code>-objects.</p><pre><code class="language-julia">nd_diffusion_vertex_2 = DDEVertex(f! = diffusionvertex!, dim = 2, sym = [:x, :ϕ])
nd_diffusion_edge_2 = StaticDelayEdge(f! = diffusionedge!, dim = 2)
nd_2 = network_dynamics(nd_diffusion_vertex_2, nd_diffusion_edge_2, g)</code></pre><pre><code class="language-none">(::DiffEqBase.DDEFunction{true,nd_DDE_Static{LightGraphs.SimpleGraphs.SimpleGraph{Int64},Array{Float64,1},Array{Float64,1},DDEVertex{typeof(Main.ex-DDEVertex.diffusionvertex!)},StaticDelayEdge{typeof(Main.ex-DDEVertex.diffusionedge!)}},LinearAlgebra.UniformScaling{Bool},Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Array{Symbol,1},Nothing}) (generic function with 2 methods)</code></pre><p>Secondly, the initial conditions are generated, where the first N values correspond to variable <code>x</code> and the values with indices from N+1 to 2N to state-variable <code>ϕ</code>, where <span>$x \sim  N(0,1)$</span>; <span>$ϕ \sim N(0,1)^2$</span>. The parameter value for the delay <span>$\Tau$</span> is set to 1.0.</p><pre><code class="language-julia">x0_2 = Array{Float64,1}(vec([randn(N).-10 randn(N).^2]&#39;)) # x ~ \mathcal{N}(0,1); ϕ ~ \mathcal{N}(0,1)^2

p = (nothing, nothing, 1.) # p = (vertexparameters, edgeparameters, delaytime)</code></pre><pre><code class="language-none">(nothing, nothing, 1.0)</code></pre><p>Now we can define the <code>DDEProblem</code>and then solve it. The <code>DDEProblem</code> is a wrapper function, which delivers an <code>ODEFunction</code>, which is compatible with the solvers of <code>DelayDiffEq.jl</code>.</p><pre><code class="language-">dde_prob_2 = DDEProblem(nd_2, x0_2, h, tspan, p)
sol_2 = solve(dde_prob_2, MethodOfSteps(Tsit5()));
plot(sol_2, legend=false)</code></pre><p>As a solver we use again <code>Tsit5()</code> with the <code>MethodOfSteps</code>-algorithm.</p><h2 id="Kuramoto-model-with-delay-1"><a class="docs-heading-anchor" href="#Kuramoto-model-with-delay-1">Kuramoto model with delay</a><a class="docs-heading-anchor-permalink" href="#Kuramoto-model-with-delay-1" title="Permalink"></a></h2><p>An additional example which will be explained in the following is the Kuramoto model. Instead of modeling a simple diffusion on an undirected ring network, we will use the Kuramoto model for the vertices and the edges but keep delay and the Watts-Strogatz graph as in the examples above.</p><p>Again, the interactions with the neighbors are described through the edge function. Unlike the diffusion example, here the edges now have a delay. For this reason we introduce the history arrays for the destination vertices and source vertices.</p><pre><code class="language-julia">function kuramoto_delay_edge!(e, v_s, v_d, h_v_s, h_v_d, p, t)
    # The coupling is no longer symmetric, so we need to store BOTH values (see tutorials for details)
    e[1] = p * sin(v_s[1] - h_v_d[1])
    e[2] = p * sin(h_v_s[1] - v_d[1])
    nothing
end</code></pre><p>Now, the contributions of the edges are summed up in each vertex so that we can define the vertex function for the Kuramoto model.</p><pre><code class="language-julia">function kuramoto_vertex!(dv, v, e_s, e_d, p, t)
    dv[1] = p
    for e in e_s
        dv[1] -= e[1]
    end
    for e in e_d
        dv[1] -= e[2]
    end
    nothing
end</code></pre><pre><code class="language-none">kuramoto_vertex! (generic function with 1 method)</code></pre><p>As for the diffusion example, we now hand over the defined functions for the Kuramoto edges and vertices to the constructors <code>DDEVertex</code> and <code>StaticEdge</code> of NetworkDynamics.jl.</p><pre><code class="language-julia">kdedge! = StaticDelayEdge(f! = kuramoto_delay_edge!, dim=2)
kdvertex! = ODEVertex(f! = kuramoto_vertex!, dim = 1)</code></pre><pre><code class="language-none">ODEVertex{typeof(Main.ex-DDEVertex.kuramoto_vertex!)}(Main.ex-DDEVertex.kuramoto_vertex!, 1, LinearAlgebra.UniformScaling{Bool}(true), Symbol[:v])</code></pre><p>Note that the edges have the dimension two, since there is no more symmetric coupling for the Kuramoto case. Accordingly, we have to set the keywork argument <code>dim</code> of <code>StaticDelayEdge</code> to two. The returned objects (<code>nd_diffusion_vertex</code> and <code>nd_diffusion_edge</code>) are passed to the key construcor <code>network_dynamics</code> together with informations of the graph which are contained in <code>g</code>.</p><pre><code class="language-julia">nd! = network_dynamics(kdvertex!, kdedge!, g)</code></pre><pre><code class="language-none">(::DiffEqBase.DDEFunction{true,nd_DDE_Static{LightGraphs.SimpleGraphs.SimpleGraph{Int64},Array{Float64,1},Array{Float64,1},DDEVertex{NetworkDynamics.ComponentFunctions.var&quot;#51#52&quot;{ODEVertex{typeof(Main.ex-DDEVertex.kuramoto_vertex!)}}},StaticDelayEdge{typeof(Main.ex-DDEVertex.kuramoto_delay_edge!)}},LinearAlgebra.UniformScaling{Bool},Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Nothing,Array{Symbol,1},Nothing}) (generic function with 2 methods)</code></pre><p>The object <code>nd!</code> returned by <code>network_dynamics</code>, is compatible with the solvers of <code>DifferentialEquations</code>.</p><p>Afterwards, random initial conditions are set for all <span>$N$</span> nodes, as well as the simulation time <code>tspan</code>, the eigenfrequencies <code>ω</code> of the <span>$N$</span> vertices, and the parameters <code>p</code> for the edges, the vertices, and the delay. Since we are dealing with a system containg a time delay, we need to set the history function <code>h</code> as for the examples above. The history function sets all default entries to 1.0 and is in-place to save allocations.</p><pre><code class="language-julia">x0 = randn(N) # random initial conditions
# history function defaults to all 1. and is in-place to save allocations
h(out, p, t) = (out .= 1.)
# p = (vertexparameters, edgeparameters, delaytime)
ω = randn(N)
ω .-= sum(ω)/N
p = (ω, 2., 1.)
tspan = (0.,20.)</code></pre><pre><code class="language-none">(0.0, 20.0)</code></pre><p>As described for the diffusion exmaple above, the constructor <code>DDEProblem</code> is used to provide an object that can be solved using the <code>solve</code> method.</p></article></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 27 July 2020 16:59">Monday 27 July 2020</span>. Using Julia version 1.3.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
